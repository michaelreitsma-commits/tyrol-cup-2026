{% extends "base.html" %}
{% block content %}
<h2>Leaderboards by Category</h2>

<p>Each racerâ€™s best time in each category is shown below. Scroll down for all logged attempts.</p>

{% for cat in categories %}
  <div class="category-block">
    <h3 class="category-title">{{ cat }}</h3>
    {% set results = category_results[cat] %}
    {% if results and results|length > 0 %}
      <table>
        <thead>
          <tr>
            <th>Rank</th>
            <th>Name</th>
            <th>Course / Run</th>
            <th>Best Time</th>
          </tr>
        </thead>
        <tbody>
          {% for row in results %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ row["name"] }}</td>
              <td>{{ row["run_name"] }}</td>
              <td>
                {% set mins = (row["best_time"] // 60)|int %}
                {% set secs = row["best_time"] - mins*60 %}
                {{ mins }}:{% if secs < 10 %}0{% endif %}{{ "%.2f"|format(secs) }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p><em>No times logged yet in this category.</em></p>
    {% endif %}
  </div>
{% endfor %}

<h2>All Attempts</h2>
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Name</th>
      <th>Age</th>
      <th>Gender</th>
      <th>Discipline</th>
      <th>Category</th>
      <th>Course / Run</th>
      <th>Time</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    {% for a in all_attempts %}
      <tr>
        <td>{{ a["date"] }}</td>
        <td>{{ a["name"] }}</td>
        <td>{{ a["age"] }}</td>
        <td>{{ a["gender"] }}</td>
        <td>{{ a["discipline"] }}</td>
        <td>{{ a["category"] }}</td>
        <td>{{ a["run_name"] }}</td>
        <td>
          {% set mins = (a["time_seconds"] // 60)|int %}
          {% set secs = a["time_seconds"] - mins*60 %}
          {{ mins }}:{% if secs < 10 %}0{% endif %}{{ "%.2f"|format(secs) }}
        </td>
        <td>{{ a["notes"] }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
